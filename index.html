<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>kc's Pokédex</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  *,*::before,*::after{box-sizing:border-box}
  html,body{margin:0;padding:0;width:100%;min-height:100vh;background:#222;color:#fff;font-family:"SF Pro Display","SF Pro Text","Segoe UI",sans-serif}

  .pokedex{
    width:100%;max-width:450px;
    margin:2em auto;padding:1em;
    background:#f00;border:8px solid #333;border-radius:8px;
    box-shadow:0 0 12px rgba(0,0,0,.5);
    display:flex;flex-direction:column;
  }
  .pokedex h1{
    margin:0 0 .5em;font-size:1.6em;
    display:flex;align-items:center;justify-content:center;gap:.4em;
  }
  .logo{width:1.4em;height:1.4em;fill:#fff;stroke:#000;stroke-width:4}

  /* separator */
  .separator{border:1px solid #333;margin:1em 0;width:100%}

  /* Type Explorer */
  .type-browser{margin-bottom:1em}
  .type-browser .types{display:flex;gap:.4em;flex-wrap:wrap;justify-content:center}
  .type-browser .types .type{
    cursor:pointer;user-select:none;
    background:#ddd;color:#000;
    padding:.2em .6em;border-radius:4px;
    font-size:.9em;text-transform:capitalize;
    transition:box-shadow .2s;
    touch-action:manipulation;
  }
  .type-browser .types .type.active{box-shadow:0 0 0 3px #fff}
  #type-screen{
    margin-top:.7em;
    background:#eee;color:#000;
    border:4px solid #333;border-radius:4px;
    padding:1em;
    display:flex;flex-direction:column;align-items:center;gap:.5em;
    transition:background-color .3s ease;
  }
  #type-screen p{margin:0;font-weight:bold;font-size:1.2em;text-align:center;color:#000!important}
  #type-screen .strength strong,
  #type-screen .weakness strong{font-weight:bold;color:#000!important}

  /* Poké-lookup controls */
  .controls.lookup-controls{
    display:flex;gap:.5em;
    margin:.7em 0;position:relative;
    justify-content:flex-start;
    align-items:stretch;
  }
  .lookup-controls .autocomplete{flex:4 1 150px}
  .lookup-controls button{flex:1 1 80px;min-width:60px}

  .controls{
    display:flex;gap:.5em;margin-bottom:.7em;position:relative;
    align-items:stretch;
  }
  .controls input{
    flex:1;padding:.6em;font-size:1em;
    border:2px solid #333;border-radius:4px;
    text-align:center;
    -webkit-appearance:none;
  }
  .controls select{
    padding:.6em;font-size:1em;
    border:2px solid #333;border-radius:4px;
    background:#fff;color:#000;
    text-transform:capitalize;
    -webkit-appearance:none;
  }
  .autocomplete{position:relative;flex:1;min-width:0}
  .controls button{
    padding:0 .8em;font-size:1em;
    border:none;border-radius:4px;
    background:#333;color:#fff;
    cursor:pointer;
    touch-action:manipulation;
    white-space:nowrap;
  }
  .list{
    position:absolute;top:100%;left:0;right:0;
    background:#fff;color:#000;
    max-height:150px;overflow:auto;
    border:1px solid #333;margin:0;padding:0;
    list-style:none;z-index:1000;
  }
  .list li{padding:.4em .6em;cursor:pointer;touch-action:manipulation}
  .list li:hover{background:#ddd}
  .list li.active{background:#bbb}

  /* default screen panels */
  .screen{
    background:#eee;color:#000;
    padding:1em;border:4px solid #333;border-radius:4px;
    display:flex;flex-direction:column;align-items:center;gap:1em;
    width:100%;
    overflow:hidden;
  }
  .display{width:100%;text-align:center;overflow:hidden}
  .display p{
    margin:0 0 .8em;font-weight:bold;font-size:1.3em;text-align:center;
    word-wrap:break-word;
  }
  .types{
    display:flex;gap:.5em;flex-wrap:wrap;justify-content:center;
    margin-bottom:.5em;
  }
  .type{
    background:#ddd;color:#000!important;
    padding:.2em .6em;border-radius:4px;
    font-size:.9em;text-transform:capitalize;
  }
  .display img{
    display:block;margin:0 auto;
    image-rendering:pixelated;
    width:75%;max-width:240px;height:auto;
    max-height:240px;
  }
  .stats{
    display:flex;gap:.5em;justify-content:center;width:100%;
  }
  .strength,.weakness{
    flex:1 1 140px;background:#fff;
    padding:.5em;border:2px solid #333;border-radius:4px;
    font-size:.9em;text-align:center;
    min-width:0;
    word-wrap:break-word;
    color:#000;
  }
  .strength{border-color:#090}
  .weakness{border-color:#900}
  .strength strong,
  .weakness strong{color:#000!important}

  /* Loading indicator */
  .loading{
    text-align:center;
    color:#666;
    font-style:italic;
  }

  /* — MOBILE ADJUSTMENTS — */
  @media (max-width:480px){
    html,body{
      overflow-x:hidden;
      width:100vw;
    }
    
    /* let the whole page scroll, no fixed heights */
    .pokedex{
      position:relative;
      width:calc(100vw - 1em);
      max-width:none;
      height:auto;
      margin:0.5em auto;
      padding:.8em;
      border-width:4px;
      border-radius:8px;
    }
    
    .pokedex h1{
      font-size:1.4em;
    }

    /* Type browser mobile fixes */
    .type-browser .types .type{
      font-size:.85em;
      padding:.3em .5em;
      min-width:0;
      flex-shrink:1;
    }

    /* ONLY stack non-lookup controls */
    .controls:not(.lookup-controls){
      flex-direction:column;
      gap:.6em;
      margin-bottom:.6em;
    }
    
    /* keep lookup row horizontal but adjust sizing */
    .controls.lookup-controls{
      flex-direction:row;
      gap:.4em;
      margin:.6em 0;
    }
    .lookup-controls .autocomplete{flex:3 1 120px;min-width:120px}
    .lookup-controls button{flex:1 1 50px;min-width:50px;padding:.6em .4em}

    /* full-width, consistent padding */
    .controls input,
    .controls select,
    .controls button{
      padding:.7em .6em;
      font-size:1em;
      border-width:2px;
    }
    
    /* make each panel height: auto and improve spacing */
    .screen{
      padding:1em;
      gap:.8em;
      margin:0;
      overflow:visible;
    }
    
    .display{
      overflow:visible;
    }
    
    .display p{
      font-size:1.2em;
      margin-bottom:.6em;
      line-height:1.3;
    }
    
    .types{
      margin-bottom:.6em;
      gap:.4em;
    }
    
    .type{
      font-size:.85em;
      padding:.25em .5em;
    }
    
    .display img{
      width:70%;
      max-width:200px;
      max-height:200px;
    }
    
    .stats{
      flex-direction:column;
      gap:.6em;
      width:100%;
    }
    
    .strength,.weakness{
      flex:none;
      width:100%;
      padding:.8em;
      font-size:.9em;
      text-align:left;
    }

    /* Improve list dropdown on mobile */
    .list{
      max-height:120px;
      font-size:.9em;
    }
    .list li{
      padding:.6em .8em;
    }
  }
</style>

<main class="pokedex">
  <h1>
    <svg class="logo" viewBox="0 0 64 64">
      <circle cx="32" cy="32" r="30"/>
      <path d="M2,32 h60"/>
      <circle cx="32" cy="32" r="12"/>
      <circle cx="32" cy="32" r="5" fill="#000"/>
    </svg>
    kc's Pokédex
  </h1>

  <!-- Type Explorer -->
  <div class="type-browser">
    <div class="types" id="type-list"></div>
    <div class="screen" id="type-screen" hidden>
      <p id="type-name">Select a type above to see details</p>
      <div class="stats" id="type-stats" style="display:none;">
        <div id="type-strong" class="strength"><strong>Strong:</strong></div>
        <div id="type-weak"   class="weakness"><strong>Weak:</strong></div>
      </div>
    </div>
  </div>

  <hr class="separator">

  <!-- Pokémon Lookup -->
  <div class="controls lookup-controls">
    <div class="autocomplete">
      <input id="i" type="text" placeholder="ID or Name" autocomplete="off">
      <ul id="list" class="list" hidden></ul>
    </div>
    <button onclick="g()">Go</button>
  </div>

  <div class="screen">
    <div class="display">
      <p id="n">Search for a Pokémon above</p>
      <div class="types" id="t"></div>
      <img id="m" alt="">
    </div>
    <div class="stats" id="pokemon-stats" style="display:none;">
      <div id="s" class="strength"><strong>Strong:</strong></div>
      <div id="w" class="weakness"><strong>Weak:</strong></div>
    </div>
    <div id="loading" class="loading" style="display:none;">Loading Pokémon data...</div>
  </div>
</main>

<script>
// Type colors mapping
const typeColors = {
  normal: '#A8A878',
  fire: '#F08030',
  water: '#6890F0',
  electric: '#F8D030',
  grass: '#78C850',
  ice: '#98D8D8',
  fighting: '#C03028',
  poison: '#A040A0',
  ground: '#E0C068',
  flying: '#A890F0',
  psychic: '#F85888',
  bug: '#A8B820',
  rock: '#B8A038',
  ghost: '#705898',
  dragon: '#7038F8',
  dark: '#705848',
  steel: '#B8B8D0',
  fairy: '#EE99AC'
};

// Type effectiveness data - what each type is strong/weak against
const typeChart = {
  normal: { weak: ['fighting'], strong: [] },
  fire: { weak: ['water', 'ground', 'rock'], strong: ['grass', 'ice', 'bug', 'steel'] },
  water: { weak: ['electric', 'grass'], strong: ['fire', 'ground', 'rock'] },
  electric: { weak: ['ground'], strong: ['water', 'flying'] },
  grass: { weak: ['fire', 'ice', 'poison', 'flying', 'bug'], strong: ['water', 'ground', 'rock'] },
  ice: { weak: ['fire', 'fighting', 'rock', 'steel'], strong: ['grass', 'ground', 'flying', 'dragon'] },
  fighting: { weak: ['flying', 'psychic', 'fairy'], strong: ['normal', 'ice', 'rock', 'dark', 'steel'] },
  poison: { weak: ['ground', 'psychic'], strong: ['grass', 'fairy'] },
  ground: { weak: ['water', 'grass', 'ice'], strong: ['fire', 'electric', 'poison', 'rock', 'steel'] },
  flying: { weak: ['electric', 'ice', 'rock'], strong: ['grass', 'fighting', 'bug'] },
  psychic: { weak: ['bug', 'ghost', 'dark'], strong: ['fighting', 'poison'] },
  bug: { weak: ['fire', 'flying', 'rock'], strong: ['grass', 'psychic', 'dark'] },
  rock: { weak: ['water', 'grass', 'fighting', 'ground', 'steel'], strong: ['fire', 'ice', 'flying', 'bug'] },
  ghost: { weak: ['ghost', 'dark'], strong: ['psychic', 'ghost'] },
  dragon: { weak: ['ice', 'dragon', 'fairy'], strong: ['dragon'] },
  dark: { weak: ['fighting', 'bug', 'fairy'], strong: ['psychic', 'ghost'] },
  steel: { weak: ['fire', 'fighting', 'ground'], strong: ['ice', 'rock', 'fairy'] },
  fairy: { weak: ['poison', 'steel'], strong: ['fighting', 'dragon', 'dark'] }
};

const types = Object.keys(typeChart);
let pokemonData = [];
let isDataLoaded = false;

// Initialize type browser
function initTypes() {
  const typeList = document.getElementById('type-list');
  types.forEach(type => {
    const span = document.createElement('span');
    span.className = 'type';
    span.textContent = type;
    span.style.backgroundColor = typeColors[type] || '#ddd';
    span.style.color = getContrastColor(typeColors[type] || '#ddd');
    span.onclick = () => showTypeInfo(type, span);
    typeList.appendChild(span);
  });
}

function showTypeInfo(type, element) {
  // Remove active class from all types
  document.querySelectorAll('.type-browser .type').forEach(t => t.classList.remove('active'));
  element.classList.add('active');
  
  const screen = document.getElementById('type-screen');
  const name = document.getElementById('type-name');
  const strong = document.getElementById('type-strong');
  const weak = document.getElementById('type-weak');
  const statsContainer = document.getElementById('type-stats');
  
  // Set the background color of the type screen
  const typeColor = typeColors[type] || '#eee';
  const textColor = getContrastColor(typeColor);
  screen.style.backgroundColor = typeColor;
  screen.style.color = textColor;
  
  // Update text color for the type name only
  name.style.color = textColor;
  
  name.textContent = type.charAt(0).toUpperCase() + type.slice(1);
  strong.innerHTML = '<strong>Strong:</strong> ' + (typeChart[type].strong.join(', ') || 'None');
  weak.innerHTML = '<strong>Weak:</strong> ' + (typeChart[type].weak.join(', ') || 'None');
  
  // Show the stats container and the screen
  statsContainer.style.display = 'flex';
  screen.hidden = false;
}

// Pokemon lookup functionality - Now loads ALL Pokémon
async function loadPokemonData() {
  if (isDataLoaded) return;
  
  const loading = document.getElementById('loading');
  loading.style.display = 'block';
  
  try {
    // First, get the total count of Pokémon from the species endpoint
    const speciesResponse = await fetch('https://pokeapi.co/api/v2/pokemon-species?limit=1');
    const speciesData = await speciesResponse.json();
    const totalPokemon = speciesData.count;
    
    console.log(`Loading ${totalPokemon} Pokémon...`);
    
    // Load all Pokémon in batches to avoid overwhelming the API
    const batchSize = 50;
    const batches = Math.ceil(totalPokemon / batchSize);
    
    for (let batch = 0; batch < batches; batch++) {
      const promises = [];
      const start = batch * batchSize + 1;
      const end = Math.min((batch + 1) * batchSize, totalPokemon);
      
      for (let i = start; i <= end; i++) {
        promises.push(loadPokemon(i));
      }
      
      const batchResults = await Promise.allSettled(promises);
      const successfulPokemon = batchResults
        .filter(result => result.status === 'fulfilled' && result.value)
        .map(result => result.value);
      
      pokemonData.push(...successfulPokemon);
      
      console.log(`Loaded batch ${batch + 1}/${batches} - Total: ${pokemonData.length} Pokémon`);
    }
    
    // Sort by ID
    pokemonData.sort((a, b) => a.id - b.id);
    isDataLoaded = true;
    
    console.log(`Finished loading ${pokemonData.length} Pokémon`);
    loading.style.display = 'none';
    
  } catch (error) {
    console.error('Failed to load Pokemon data:', error);
    loading.textContent = 'Failed to load Pokémon data. Please refresh the page.';
  }
}

async function loadPokemon(id) {
  try {
    const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
    if (!response.ok) return null;
    
    const pokemon = await response.json();
    return {
      id: pokemon.id,
      name: pokemon.name,
      types: pokemon.types.map(t => t.type.name),
      sprite: pokemon.sprites?.front_default || pokemon.sprites?.other?.['official-artwork']?.front_default
    };
  } catch (error) {
    console.error(`Failed to load Pokemon ${id}:`, error);
    return null;
  }
}

function setupAutocomplete() {
  const input = document.getElementById('i');
  const list = document.getElementById('list');
  let activeIndex = -1;

  input.addEventListener('input', function() {
    const value = this.value.toLowerCase();
    list.innerHTML = '';
    activeIndex = -1;
    
    if (!value || !isDataLoaded) {
      list.hidden = true;
      return;
    }

    const matches = pokemonData.filter(p => 
      p.name.toLowerCase().includes(value) || 
      p.id.toString().includes(value)
    ).slice(0, 10);

    if (matches.length > 0) {
      matches.forEach((pokemon, index) => {
        const li = document.createElement('li');
        li.textContent = `#${pokemon.id} ${capitalizeWords(pokemon.name)}`;
        li.onclick = () => {
          input.value = pokemon.name;
          list.hidden = true;
          g();
        };
        list.appendChild(li);
      });
      list.hidden = false;
    } else {
      list.hidden = true;
    }
  });

  input.addEventListener('keydown', function(e) {
    const items = list.querySelectorAll('li');
    
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      activeIndex = Math.min(activeIndex + 1, items.length - 1);
      updateActiveItem(items);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      activeIndex = Math.max(activeIndex - 1, -1);
      updateActiveItem(items);
    } else if (e.key === 'Enter') {
      e.preventDefault();
      if (activeIndex >= 0 && items[activeIndex]) {
        items[activeIndex].click();
      } else {
        g();
      }
    } else if (e.key === 'Escape') {
      list.hidden = true;
      activeIndex = -1;
    }
  });

  function updateActiveItem(items) {
    items.forEach((item, index) => {
      item.classList.toggle('active', index === activeIndex);
    });
  }

  // Hide list when clicking outside
  document.addEventListener('click', function(e) {
    if (!input.contains(e.target) && !list.contains(e.target)) {
      list.hidden = true;
    }
  });
}

async function g() {
  if (!isDataLoaded) {
    alert('Pokémon data is still loading. Please wait...');
    return;
  }

  const input = document.getElementById('i');
  const value = input.value.toLowerCase().trim();
  
  if (!value) return;

  // Hide autocomplete
  document.getElementById('list').hidden = true;

  // Find pokemon by name or ID
  let pokemon = pokemonData.find(p => 
    p.name.toLowerCase() === value || 
    p.id.toString() === value
  );

  if (!pokemon) {
    // Try partial match
    pokemon = pokemonData.find(p => 
      p.name.toLowerCase().includes(value)
    );
  }

  const statsContainer = document.getElementById('pokemon-stats');

  if (!pokemon) {
    document.getElementById('n').textContent = 'Pokémon not found';
    document.getElementById('t').innerHTML = '';
    document.getElementById('m').src = '';
    statsContainer.style.display = 'none';
    return;
  }

  // Display pokemon info
  document.getElementById('n').textContent = `#${pokemon.id} ${capitalizeWords(pokemon.name)}`;
  
  const typesContainer = document.getElementById('t');
  typesContainer.innerHTML = '';
  pokemon.types.forEach(type => {
    const span = document.createElement('span');
    span.className = 'type';
    span.textContent = type;
    span.style.backgroundColor = typeColors[type] || '#ddd';
    span.style.color = '#000';
    typesContainer.appendChild(span);
  });

  document.getElementById('m').src = pokemon.sprite || '';

  // Calculate strengths and weaknesses
  const strengths = new Set();
  const weaknesses = new Set();

  pokemon.types.forEach(type => {
    if (typeChart[type]) {
      typeChart[type].strong.forEach(s => strengths.add(s));
      typeChart[type].weak.forEach(w => weaknesses.add(w));
    }
  });

  document.getElementById('s').innerHTML = '<strong>Strong:</strong> ' + 
    (strengths.size > 0 ? Array.from(strengths).join(', ') : 'None');
  document.getElementById('w').innerHTML = '<strong>Weak:</strong> ' + 
    (weaknesses.size > 0 ? Array.from(weaknesses).join(', ') : 'None');

  // Show the stats container now that we have a Pokémon
  statsContainer.style.display = 'flex';
}

// Utility function to capitalize words properly
function capitalizeWords(str) {
  return str.split('-').map(word => 
    word.charAt(0).toUpperCase() + word.slice(1)
  ).join(' ');
}

// Function to determine text color based on background color
function getContrastColor(hexColor) {
  // Convert hex to RGB
  const r = parseInt(hexColor.slice(1, 3), 16);
  const g = parseInt(hexColor.slice(3, 5), 16);
  const b = parseInt(hexColor.slice(5, 7), 16);
  
  // Calculate luminance
  const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
  
  // Return black for light backgrounds, white for dark
  return luminance > 0.5 ? '#000' : '#fff';
}

// Initialize everything
document.addEventListener('DOMContentLoaded', function() {
  initTypes();
  setupAutocomplete();
  
  // Start loading Pokémon data in the background
  loadPokemonData();
});
</script>
</html>